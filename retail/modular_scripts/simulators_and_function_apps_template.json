{
   "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
   "contentVersion": "1.0.0.0",
   "parameters": {
      "livestreaming_video_analytics_Realtime_URL": {
         "type": "String",
         "metadata": {
            "description": "PowerBi streaming dataset URL for Livestreaming Video Analytics Realtime."
         }
      },
      "video_indexer_account_id": {
         "type": "String",
         "metadata": {
            "description": ""
         }
      },
      "func_media_recommendation_service_asp_name": {
         "type": "String",
         "metadata": {
            "description": ""
         }
      },
      "func_media_recommendation_service_storage_name": {
         "type": "String",
         "metadata": {
            "description": ""
         }
      },
      "func_media_recommendation_service_ai_name": {
         "type": "String",
         "metadata": {
            "description": ""
         }
      },
      "func_media_recommendation_service_app_name": {
         "type": "String",
         "metadata": {
            "description": ""
         }
      },
      "func_model_builder_service_asp_name": {
         "type": "String",
         "metadata": {
            "description": ""
         }
      },
      "func_model_builder_service_ai_name": {
         "type": "String",
         "metadata": {
            "description": ""
         }
      },
      "func_model_builder_service_storage_name": {
         "type": "String",
         "metadata": {
            "description": ""
         }
      },
      "func_model_builder_service_app_name": {
         "type": "String",
         "metadata": {
            "description": ""
         }
      },
      "func_media_transcript_app_name": {
         "type": "String",
         "metadata": {
            "description": ""
         }
      },
      "func_media_transcript_asp_name": {
         "type": "String",
         "metadata": {
            "description": ""
         }
      },
      "func_media_transcript_storage_name": {
         "type": "String",
         "metadata": {
            "description": ""
         }
      },
      "func_livestreaming_video_analytics_asp_name": {
         "type": "String",
         "metadata": {
            "description": ""
         }
      },
      "func_livestreaming_video_analytics_name": {
         "type": "String",
         "metadata": {
            "description": ""
         }
      },
      "func_product_search_asp_name": {
         "type": "String",
         "metadata": {
            "description": ""
         }
      },
      "sites_product_search_ui_app_name": {
         "type": "String",
         "metadata": {
            "description": ""
         }
      },
      "serverfarm_product_search_ui_app_name": {
         "type": "String",
         "metadata": {
            "description": ""
         }
      },
      "sites_adx_thermostat_realtime_name": {
         "type": "String",
         "metadata": {
            "description": ""
         }
      },
      "serverfarm_adx_thermostat_realtime_name": {
         "type": "String",
         "metadata": {
            "description": ""
         }
      },
      "sites_app_iotfoottraffic_sensor_retail_name": {
         "type": "String",
         "metadata": {
            "description": ""
         }
      },
      "serverfarm_app_iotfoottraffic_sensor_retail_name": {
         "type": "String",
         "metadata": {
            "description": ""
         }
      },
      "resource_group_name": {
         "type": "String",
         "metadata": {
            "description": ""
         }
      },
      "location": {
         "type": "String",
         "metadata": {
            "description": ""
         }
      }
   },
   "variables": {
      "unique_suffix": "[concat(uniqueString(deployment().name), '-', parameters('environment_code'))]",
      "storage_account_name": "[if(greater(length(concat('stretail', parameters('environment_code'),uniqueString(deployment().name))), 24), substring(concat('stretail',parameters('environment_code'),uniqueString(deployment().name)),0,24) , concat('stretail',parameters('environment_code'),uniqueString(deployment().name)) )]",
      "cosmosdb_retail2_name": "[if(greater(length(concat('cosmosdb-retail2-', uniqueString(deployment().name),parameters('environment_code'))), 43), substring(concat('cosmosdb-retail2-', uniqueString(deployment().name),parameters('environment_code')),0,43) , concat('cosmosdb-retail2-', uniqueString(deployment().name),parameters('environment_code')) )]",
      "cosmos_database_video_indexer": "video-indexer",
      "source_storage_container": "media-assets"
   },
   "resources": [
      {
         "name": "[parameters('func_media_recommendation_service_asp_name')]",
         "type": "Microsoft.Web/serverfarms",
         "apiVersion": "2018-02-01",
         "location": "[parameters('location')]",
         "sku": {
            "name": "B1"
         },
         "kind": "linux",
         "properties": {
            "reserved": true
         }
      },
      {
         "name": "[parameters('func_media_recommendation_service_storage_name')]",
         "type": "Microsoft.Storage/storageAccounts",
         "apiVersion": "2019-04-01",
         "sku": {
            "name": "Standard_LRS",
            "tier": "Standard"
         },
         "kind": "Storage",
         "location": "[parameters('location')]",
         "properties": {

         }
      },
      {
         "name": "[parameters('func_media_recommendation_service_ai_name')]",
         "type": "Microsoft.Insights/components",
         "apiVersion": "2018-05-01-preview",
         "location": "[parameters('location')]",
         "properties": {
            "Application_Type": "web",
            "Flow_Type": "Bluefield",
            "Request_Source": "rest"
         }
      },
      {
         "name": "[parameters('func_media_recommendation_service_app_name')]",
         "type": "Microsoft.Web/sites",
         "apiVersion": "2018-11-01",
         "location": "[parameters('location')]",
         "dependsOn": [
            "[concat('Microsoft.Storage/storageAccounts/', parameters('func_media_recommendation_service_storage_name'))]",
            "[concat('Microsoft.Web/serverfarms/', parameters('func_media_recommendation_service_asp_name'))]",
            "[concat('Microsoft.Insights/components/', parameters('func_media_recommendation_service_ai_name'))]"
         ],
         "kind": "functionapp",
         "properties": {
            "enabled": true,
            "hostNameSslStates": [
               {
                  "name": "[concat(parameters('func_media_recommendation_service_app_name'), '.azurewebsites.net')]",
                  "sslState": "Disabled",
                  "hostType": "Standard"
               },
               {
                  "name": "[concat(parameters('func_media_recommendation_service_app_name'), '.scm.azurewebsites.net')]",
                  "sslState": "Disabled",
                  "hostType": "Repository"
               }
            ],
            "serverFarmId": "[resourceId(parameters('resource_group_name'), 'Microsoft.Web/serverfarms', parameters('func_media_recommendation_service_asp_name'))]",
            "reserved": false,
            "siteConfig": {
               "netFrameworkVersion": "v4.0",
               "appSettings": [
                  {
                     "name": "AzureWebJobsStorage",
                     "value": "[concat('DefaultEndpointsProtocol=https;AccountName=', parameters('func_media_recommendation_service_storage_name'), ';AccountKey=',listKeys(resourceId('Microsoft.Storage/storageAccounts', parameters('func_media_recommendation_service_storage_name')), '2019-04-01').keys[0].value)]"
                  },
                  {
                     "name": "CONNECTIONSTRING",
                     "value": "[concat('DefaultEndpointsProtocol=https;AccountName=', variables('storage_account_name'), ';AccountKey=', listKeys(resourceId(parameters('resource_group_name'),'Microsoft.Storage/storageAccounts', variables('storage_account_name')), '2019-04-01').keys[0].value,';EndpointSuffix=core.windows.net')]"
                  },
                  {
                     "name": "CONTAINER_WITH_VIDEO_JSONS",
                     "value": "finalmediademostorage"
                  },
                  {
                     "name": "CONTAINER_WITH_MODELS",
                     "value": "recommendermodel"
                  },
                  {
                     "name": "APPINSIGHTS_INSTRUMENTATIONKEY",
                     "value": "[reference(resourceId('Microsoft.Insights/components', parameters('func_media_recommendation_service_ai_name'))).InstrumentationKey]"
                  },
                  {
                     "name": "FUNCTIONS_WORKER_RUNTIME",
                     "value": "python"
                  },
                  {
                     "name": "FUNCTIONS_EXTENSION_VERSION",
                     "value": "~2"
                  },
                  {
                     "name": "DISABLE_HUGO_BUILD",
                     "value": "true"
                  },
                  {
                     "name": "WEBSITE_RUN_FROM_PACKAGE",
                     "value": "true"
                  }
               ],
               "use32BitWorkerProcess": true,
               "managedPipelineMode": "Integrated",
               "cors": {
                  "allowedOrigins": [
                     "https://functions.azure.com",
                     "https://functions-staging.azure.com",
                     "https://functions-next.azure.com"
                  ],
                  "supportCredentials": false
               }
            },
            "containerSize": 1536,
            "httpsOnly": false
         }
      },
      {
         "type": "Microsoft.Web/sites/config",
         "apiVersion": "2018-11-01",
         "name": "[concat(parameters('func_media_recommendation_service_app_name'), '/web')]",
         "location": "[parameters('location')]",
         "dependsOn": [
            "[resourceId('Microsoft.Web/sites', parameters('func_media_recommendation_service_app_name'))]"
         ],
         "properties": {
            "numberOfWorkers": 1,
            "defaultDocuments": [
               "Default.htm",
               "Default.html",
               "Default.asp",
               "index.htm",
               "index.html",
               "iisstart.htm",
               "default.aspx",
               "index.php",
               "hostingstart.html"
            ],
            "netFrameworkVersion": "v4.0",
            "linuxFxVersion": "PYTHON|3.8",
            "requestTracingEnabled": false,
            "remoteDebuggingEnabled": false,
            "httpLoggingEnabled": false,
            "logsDirectorySizeLimit": 35,
            "detailedErrorLoggingEnabled": false,
            "publishingUsername": "[concat('$', parameters('func_media_recommendation_service_app_name'))]",
            "azureStorageAccounts": {

            },
            "scmType": "None",
            "use32BitWorkerProcess": true,
            "webSocketsEnabled": false,
            "alwaysOn": true,
            "managedPipelineMode": "Integrated",
            "virtualApplications": [
               {
                  "virtualPath": "/",
                  "physicalPath": "site\\wwwroot",
                  "preloadEnabled": true
               }
            ],
            "loadBalancing": "LeastRequests",
            "experiments": {
               "rampUpRules": [

               ]
            },
            "autoHealEnabled": false,
            "localMySqlEnabled": false,
            "ipSecurityRestrictions": [
               {
                  "ipAddress": "Any",
                  "action": "Allow",
                  "priority": 1,
                  "name": "Allow all",
                  "description": "Allow all access"
               }
            ],
            "scmIpSecurityRestrictions": [
               {
                  "ipAddress": "Any",
                  "action": "Allow",
                  "priority": 1,
                  "name": "Allow all",
                  "description": "Allow all access"
               }
            ],
            "scmIpSecurityRestrictionsUseMain": false,
            "http20Enabled": false,
            "minTlsVersion": "1.2",
            "ftpsState": "AllAllowed",
            "reservedInstanceCount": 0
         }
      },
      {
         "name": "[parameters('func_model_builder_service_asp_name')]",
         "type": "Microsoft.Web/serverfarms",
         "apiVersion": "2018-02-01",
         "location": "[parameters('location')]",
         "sku": {
            "name": "B1"
         },
         "kind": "linux",
         "properties": {
            "reserved": true
         }
      },
      {
         "name": "[parameters('func_model_builder_service_storage_name')]",
         "type": "Microsoft.Storage/storageAccounts",
         "apiVersion": "2019-04-01",
         "sku": {
            "name": "Standard_LRS",
            "tier": "Standard"
         },
         "kind": "Storage",
         "location": "[parameters('location')]",
         "properties": {

         }
      },
      {
         "name": "[parameters('func_model_builder_service_ai_name')]",
         "type": "Microsoft.Insights/components",
         "apiVersion": "2018-05-01-preview",
         "location": "[parameters('location')]",
         "properties": {
            "Application_Type": "web",
            "Flow_Type": "Bluefield",
            "Request_Source": "rest"
         }
      },
      {
         "name": "[parameters('func_model_builder_service_app_name')]",
         "type": "Microsoft.Web/sites",
         "apiVersion": "2018-11-01",
         "location": "[parameters('location')]",
         "dependsOn": [
            "[concat('Microsoft.Storage/storageAccounts/', parameters('func_model_builder_service_storage_name'))]",
            "[concat('Microsoft.Web/serverfarms/', parameters('func_model_builder_service_asp_name'))]",
            "[concat('Microsoft.Insights/components/', parameters('func_model_builder_service_ai_name'))]"
         ],
         "kind": "functionapp",
         "properties": {
            "enabled": true,
            "hostNameSslStates": [
               {
                  "name": "[concat(parameters('func_model_builder_service_app_name'), '.azurewebsites.net')]",
                  "sslState": "Disabled",
                  "hostType": "Standard"
               },
               {
                  "name": "[concat(parameters('func_model_builder_service_app_name'), '.scm.azurewebsites.net')]",
                  "sslState": "Disabled",
                  "hostType": "Repository"
               }
            ],
            "serverFarmId": "[resourceId(parameters('resource_group_name'), 'Microsoft.Web/serverfarms', parameters('func_model_builder_service_asp_name'))]",
            "reserved": false,
            "siteConfig": {
               "netFrameworkVersion": "v4.0",
               "appSettings": [
                  {
                     "name": "AzureWebJobsStorage",
                     "value": "[concat('DefaultEndpointsProtocol=https;AccountName=', parameters('func_model_builder_service_storage_name'), ';AccountKey=',listKeys(resourceId('Microsoft.Storage/storageAccounts', parameters('func_model_builder_service_storage_name')), '2019-04-01').keys[0].value)]"
                  },
                  {
                     "name": "APPINSIGHTS_INSTRUMENTATIONKEY",
                     "value": "[reference(resourceId('Microsoft.Insights/components', parameters('func_model_builder_service_ai_name'))).InstrumentationKey]"
                  },
                  {
                     "name": "AzureWebJobs.recommender.Disabled",
                     "value": "0"
                  },
                  {
                     "name": "CONNECTIONSTRING",
                     "value": "[concat('DefaultEndpointsProtocol=https;AccountName=', variables('storage_account_name'), ';AccountKey=', listKeys(resourceId(parameters('resource_group_name'),'Microsoft.Storage/storageAccounts', variables('storage_account_name')), '2019-04-01').keys[0].value,';EndpointSuffix=core.windows.net')]"
                  },
                  {
                     "name": "CONTAINER_WITH_VIDEO_JSONS",
                     "value": "finalmediademostorage"
                  },
                  {
                     "name": "CONTAINER_WITH_MODELS",
                     "value": "recommendermodel"
                  },
                  {
                     "name": "VIDEO_INDEXER_URL",
                     "value": "[concat('https://api.videoindexer.ai/trial/Accounts/',parameters('video_indexer_account_id'),'/Videos/{}/Index?reTranslate=False&includeStreamingUrls=True')]"
                  },
                  {
                     "name": "FUNCTIONS_WORKER_RUNTIME",
                     "value": "python"
                  },
                  {
                     "name": "FUNCTIONS_EXTENSION_VERSION",
                     "value": "~2"
                  },
                  {
                     "name": "DISABLE_HUGO_BUILD",
                     "value": "true"
                  },
                  {
                     "name": "WEBSITE_RUN_FROM_PACKAGE",
                     "value": "true"
                  }
               ],
               "use32BitWorkerProcess": true,
               "managedPipelineMode": "Integrated",
               "cors": {
                  "allowedOrigins": [
                     "https://functions.azure.com",
                     "https://functions-staging.azure.com",
                     "https://functions-next.azure.com"
                  ],
                  "supportCredentials": false
               }
            },
            "containerSize": 1536,
            "httpsOnly": false
         }
      },
      {
         "type": "Microsoft.Web/sites/config",
         "apiVersion": "2018-11-01",
         "name": "[concat(parameters('func_model_builder_service_app_name'), '/web')]",
         "location": "[parameters('location')]",
         "dependsOn": [
            "[resourceId('Microsoft.Web/sites', parameters('func_model_builder_service_app_name'))]"
         ],
         "properties": {
            "numberOfWorkers": 1,
            "defaultDocuments": [
               "Default.htm",
               "Default.html",
               "Default.asp",
               "index.htm",
               "index.html",
               "iisstart.htm",
               "default.aspx",
               "index.php",
               "hostingstart.html"
            ],
            "netFrameworkVersion": "v4.0",
            "linuxFxVersion": "PYTHON|3.8",
            "requestTracingEnabled": false,
            "remoteDebuggingEnabled": false,
            "httpLoggingEnabled": false,
            "logsDirectorySizeLimit": 35,
            "detailedErrorLoggingEnabled": false,
            "publishingUsername": "[concat('$', parameters('func_model_builder_service_app_name'))]",
            "azureStorageAccounts": {

            },
            "scmType": "None",
            "use32BitWorkerProcess": true,
            "webSocketsEnabled": false,
            "alwaysOn": true,
            "managedPipelineMode": "Integrated",
            "virtualApplications": [
               {
                  "virtualPath": "/",
                  "physicalPath": "site\\wwwroot",
                  "preloadEnabled": true
               }
            ],
            "loadBalancing": "LeastRequests",
            "experiments": {
               "rampUpRules": [

               ]
            },
            "autoHealEnabled": false,
            "localMySqlEnabled": false,
            "ipSecurityRestrictions": [
               {
                  "ipAddress": "Any",
                  "action": "Allow",
                  "priority": 1,
                  "name": "Allow all",
                  "description": "Allow all access"
               }
            ],
            "scmIpSecurityRestrictions": [
               {
                  "ipAddress": "Any",
                  "action": "Allow",
                  "priority": 1,
                  "name": "Allow all",
                  "description": "Allow all access"
               }
            ],
            "scmIpSecurityRestrictionsUseMain": false,
            "http20Enabled": false,
            "minTlsVersion": "1.2",
            "ftpsState": "AllAllowed",
            "reservedInstanceCount": 0
         }
      },
      {
         "type": "Microsoft.Web/serverfarms",
         "apiVersion": "2020-06-01",
         "name": "[parameters('func_media_transcript_asp_name')]",
         "location": "[parameters('location')]",
         "sku": {
            "name": "B1"
         },
         "kind": "linux",
         "properties": {
            "reserved": true
         }
      },
      {
         "name": "[parameters('func_media_transcript_storage_name')]",
         "type": "Microsoft.Storage/storageAccounts",
         "apiVersion": "2019-04-01",
         "sku": {
            "name": "Standard_LRS",
            "tier": "Standard"
         },
         "kind": "Storage",
         "location": "[parameters('location')]",
         "properties": {

         }
      },
      {
         "name": "[parameters('func_media_transcript_app_name')]",
         "type": "Microsoft.Web/sites",
         "apiVersion": "2018-11-01",
         "location": "[parameters('location')]",
         "dependsOn": [
            "[concat('Microsoft.Storage/storageAccounts/', parameters('func_media_transcript_storage_name'))]",
            "[concat('Microsoft.Web/serverfarms/', parameters('func_media_transcript_asp_name'))]",
            "[concat('Microsoft.DocumentDB/databaseAccounts/', toLower(variables('cosmosdb_retail2_name')))]"
         ],
         "kind": "functionapp",
         "properties": {
            "enabled": true,
            "hostNameSslStates": [
               {
                  "name": "[concat(parameters('func_media_transcript_app_name'), '.azurewebsites.net')]",
                  "sslState": "Disabled",
                  "hostType": "Standard"
               },
               {
                  "name": "[concat(parameters('func_media_transcript_app_name'), '.scm.azurewebsites.net')]",
                  "sslState": "Disabled",
                  "hostType": "Repository"
               }
            ],
            "serverFarmId": "[resourceId(parameters('resource_group_name'), 'Microsoft.Web/serverfarms', parameters('func_media_transcript_asp_name'))]",
            "reserved": false,
            "siteConfig": {
               "netFrameworkVersion": "v4.0",
               "appSettings": [
                  {
                     "name": "AzureWebJobsDashboard",
                     "value": "[concat('DefaultEndpointsProtocol=https;AccountName=', parameters('func_media_transcript_storage_name'), ';AccountKey=', listKeys(resourceId('Microsoft.Storage/storageAccounts', parameters('func_media_transcript_storage_name')), '2019-04-01').keys[0].value)]"
                  },
                  {
                     "name": "AzureWebJobsStorage",
                     "value": "[concat('DefaultEndpointsProtocol=https;AccountName=', parameters('func_media_transcript_storage_name'), ';AccountKey=',listKeys(resourceId('Microsoft.Storage/storageAccounts', parameters('func_media_transcript_storage_name')), '2019-04-01').keys[0].value)]"
                  },
                  {
                     "name": "WEBSITE_CONTENTAZUREFILECONNECTIONSTRING",
                     "value": "[concat('DefaultEndpointsProtocol=https;AccountName=', parameters('func_media_transcript_storage_name'), ';AccountKey=', listKeys(resourceId('Microsoft.Storage/storageAccounts', parameters('func_media_transcript_storage_name')), '2019-04-01').keys[0].value)]"
                  },
                  {
                     "name": "FUNCTIONS_WORKER_RUNTIME",
                     "value": "dotnet"
                  },
                  {
                     "name": "FUNCTIONS_EXTENSION_VERSION",
                     "value": "~2"
                  },
                  {
                     "name": "collectionName",
                     "value": "transcript"
                  },
                  {
                     "name": "CosmosDbConnectionString",
                     "value": "[concat('AccountEndpoint=https://', variables('cosmosdb_retail2_name'), '.documents.azure.com:443/;AccountKey=',listKeys(resourceId('Microsoft.DocumentDB/databaseAccounts', variables('cosmosdb_retail2_name')), providers('Microsoft.DocumentDB', 'databaseAccounts').apiVersions[0]).primaryMasterKey,';')]"
                  },
                  {
                     "name": "databaseName",
                     "value": "[variables('cosmos_database_video_indexer')]"
                  },
                  {
                     "name": "WEBSITE_RUN_FROM_PACKAGE",
                     "value": "true"
                  },
                  {
                     "name": "STORAGE_CONTAINER_NAME",
                     "value": "[variables('source_storage_container')]"
                  },
                  {
                     "name": "STORAGE_FILE_NAME",
                     "value": "videoindexer.json"
                  }
               ],
               "use32BitWorkerProcess": true,
               "managedPipelineMode": "Integrated",
               "cors": {
                  "allowedOrigins": [
                     "https://functions.azure.com",
                     "https://functions-staging.azure.com",
                     "https://functions-next.azure.com"
                  ],
                  "supportCredentials": false
               }
            },
            "containerSize": 1536,
            "httpsOnly": false
         }
      },
      {
         "name": "[parameters('serverfarm_adx_thermostat_realtime_name')]",
         "type": "Microsoft.Web/serverfarms",
         "apiVersion": "2019-08-01",
         "location": "[parameters('location')]",
         "sku": {
            "name": "S1"
         },
         "kind": "linux",
         "properties": {
            "reserved": true
         }
      },
      {
         "type": "Microsoft.Web/sites",
         "apiVersion": "2021-02-01",
         "name": "[parameters('sites_adx_thermostat_realtime_name')]",
         "location": "[parameters('location')]",
         "dependsOn": [
            "[resourceId('Microsoft.Web/serverfarms', parameters('serverfarm_adx_thermostat_realtime_name'))]"
         ],
         "kind": "app,linux",
         "properties": {
            "enabled": true,
            "hostNameSslStates": [
               {
                  "name": "[concat(parameters('sites_adx_thermostat_realtime_name'), '.azurewebsites.net')]",
                  "sslState": "Disabled",
                  "hostType": "Standard"
               },
               {
                  "name": "[concat(parameters('sites_adx_thermostat_realtime_name'), '.scm.azurewebsites.net')]",
                  "sslState": "Disabled",
                  "hostType": "Repository"
               }
            ],
            "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', parameters('serverfarm_adx_thermostat_realtime_name'))]",
            "reserved": true,
            "isXenon": false,
            "hyperV": false,
            "siteConfig": {
               "numberOfWorkers": 1,
               "linuxFxVersion": "PYTHON|3.9",
               "acrUseManagedIdentityCreds": false,
               "alwaysOn": false,
               "http20Enabled": false,
               "functionAppScaleLimit": 0,
               "minimumElasticInstanceCount": 1
            },
            "scmSiteAlsoStopped": false,
            "clientAffinityEnabled": false,
            "clientCertEnabled": false,
            "clientCertMode": "Required",
            "hostNamesDisabled": false,
            "customDomainVerificationId": "B10DC0753E56AF5562749748B185627EB8773B3C5160FA954F891FDBF5E7D19A",
            "containerSize": 0,
            "dailyMemoryTimeQuota": 0,
            "httpsOnly": false,
            "redundancyMode": "None",
            "storageAccountRequired": false,
            "keyVaultReferenceIdentity": "SystemAssigned"
         }
      },
      {
         "type": "Microsoft.Web/sites/basicPublishingCredentialsPolicies",
         "apiVersion": "2021-02-01",
         "name": "[concat(parameters('sites_adx_thermostat_realtime_name'), '/ftp')]",
         "location": "[parameters('location')]",
         "dependsOn": [
            "[resourceId('Microsoft.Web/sites', parameters('sites_adx_thermostat_realtime_name'))]"
         ],
         "properties": {
            "allow": true
         }
      },
      {
         "type": "Microsoft.Web/sites/basicPublishingCredentialsPolicies",
         "apiVersion": "2021-02-01",
         "name": "[concat(parameters('sites_adx_thermostat_realtime_name'), '/scm')]",
         "location": "[parameters('location')]",
         "dependsOn": [
            "[resourceId('Microsoft.Web/sites', parameters('sites_adx_thermostat_realtime_name'))]"
         ],
         "properties": {
            "allow": true
         }
      },
      {
         "type": "Microsoft.Web/sites/config",
         "apiVersion": "2021-02-01",
         "name": "[concat(parameters('sites_adx_thermostat_realtime_name'), '/web')]",
         "location": "[parameters('location')]",
         "dependsOn": [
            "[resourceId('Microsoft.Web/sites', parameters('sites_adx_thermostat_realtime_name'))]"
         ],
         "properties": {
            "numberOfWorkers": 1,
            "defaultDocuments": [
               "Default.htm",
               "Default.html",
               "Default.asp",
               "index.htm",
               "index.html",
               "iisstart.htm",
               "default.aspx",
               "index.php",
               "hostingstart.html"
            ],
            "netFrameworkVersion": "v4.0",
            "linuxFxVersion": "PYTHON|3.9",
            "requestTracingEnabled": false,
            "remoteDebuggingEnabled": false,
            "remoteDebuggingVersion": "VS2019",
            "httpLoggingEnabled": false,
            "acrUseManagedIdentityCreds": false,
            "logsDirectorySizeLimit": 35,
            "detailedErrorLoggingEnabled": false,
            "publishingUsername": "$adx-thermostat-realtime",
            "scmType": "None",
            "use32BitWorkerProcess": true,
            "webSocketsEnabled": false,
            "alwaysOn": false,
            "managedPipelineMode": "Integrated",
            "virtualApplications": [
               {
                  "virtualPath": "/",
                  "physicalPath": "site\\wwwroot",
                  "preloadEnabled": false
               }
            ],
            "loadBalancing": "LeastRequests",
            "experiments": {
               "rampUpRules": [

               ]
            },
            "autoHealEnabled": false,
            "vnetRouteAllEnabled": false,
            "vnetPrivatePortsCount": 0,
            "localMySqlEnabled": false,
            "ipSecurityRestrictions": [
               {
                  "ipAddress": "Any",
                  "action": "Allow",
                  "priority": 1,
                  "name": "Allow all",
                  "description": "Allow all access"
               }
            ],
            "scmIpSecurityRestrictions": [
               {
                  "ipAddress": "Any",
                  "action": "Allow",
                  "priority": 1,
                  "name": "Allow all",
                  "description": "Allow all access"
               }
            ],
            "scmIpSecurityRestrictionsUseMain": false,
            "http20Enabled": false,
            "minTlsVersion": "1.2",
            "scmMinTlsVersion": "1.0",
            "ftpsState": "AllAllowed",
            "preWarmedInstanceCount": 0,
            "functionAppScaleLimit": 0,
            "functionsRuntimeScaleMonitoringEnabled": false,
            "minimumElasticInstanceCount": 1,
            "azureStorageAccounts": {

            }
         }
      },
      {
         "type": "Microsoft.Web/sites/hostNameBindings",
         "apiVersion": "2021-02-01",
         "name": "[concat(parameters('sites_adx_thermostat_realtime_name'), '/', parameters('sites_adx_thermostat_realtime_name'), '.azurewebsites.net')]",
         "location": "[parameters('location')]",
         "dependsOn": [
            "[resourceId('Microsoft.Web/sites', parameters('sites_adx_thermostat_realtime_name'))]"
         ],
         "properties": {
            "siteName": "[parameters('sites_adx_thermostat_realtime_name')]",
            "hostNameType": "Verified"
         }
      },
      {
         "name": "[parameters('serverfarm_app_iotfoottraffic_sensor_retail_name')]",
         "type": "Microsoft.Web/serverfarms",
         "apiVersion": "2019-08-01",
         "location": "[parameters('location')]",
         "sku": {
            "name": "S1"
         },
         "kind": "linux",
         "properties": {
            "reserved": true
         }
      },
      {
         "type": "Microsoft.Web/sites",
         "apiVersion": "2021-02-01",
         "name": "[parameters('sites_app_iotfoottraffic_sensor_retail_name')]",
         "location": "[parameters('location')]",
         "dependsOn": [
            "[resourceId('Microsoft.Web/serverfarms', parameters('serverfarm_app_iotfoottraffic_sensor_retail_name'))]"
         ],
         "kind": "app,linux",
         "properties": {
            "enabled": true,
            "hostNameSslStates": [
               {
                  "name": "[concat(parameters('sites_app_iotfoottraffic_sensor_retail_name'), '.azurewebsites.net')]",
                  "sslState": "Disabled",
                  "hostType": "Standard"
               },
               {
                  "name": "[concat(parameters('sites_app_iotfoottraffic_sensor_retail_name'), '.scm.azurewebsites.net')]",
                  "sslState": "Disabled",
                  "hostType": "Repository"
               }
            ],
            "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', parameters('serverfarm_app_iotfoottraffic_sensor_retail_name'))]",
            "reserved": true,
            "isXenon": false,
            "hyperV": false,
            "siteConfig": {
               "numberOfWorkers": 1,
               "linuxFxVersion": "PYTHON|3.7",
               "acrUseManagedIdentityCreds": false,
               "alwaysOn": false,
               "http20Enabled": false,
               "functionAppScaleLimit": 0,
               "minimumElasticInstanceCount": 0,
               "appSettings": [
                  {
                     "name": "IoTHubConfig",
                     "value": ""
                  },
                  {
                     "name": "IoTSimulatorConfigs",
                     "value": "{\"main_data_frequency_seconds\":1,\"data\":[{\"before-foottraffic\":{\"minValue\":18,\"maxValue\":25}},{\"after-foottraffic\":{\"minValue\":35,\"maxValue\":45}}]}"
                  }
               ]
            },
            "scmSiteAlsoStopped": false,
            "clientAffinityEnabled": false,
            "clientCertEnabled": false,
            "clientCertMode": "Required",
            "hostNamesDisabled": false,
            "customDomainVerificationId": "B10DC0753E56AF5562749748B185627EB8773B3C5160FA954F891FDBF5E7D19A",
            "containerSize": 0,
            "dailyMemoryTimeQuota": 0,
            "httpsOnly": false,
            "redundancyMode": "None",
            "storageAccountRequired": false,
            "keyVaultReferenceIdentity": "SystemAssigned"
         }
      },
      {
         "type": "Microsoft.Web/sites/basicPublishingCredentialsPolicies",
         "apiVersion": "2021-02-01",
         "name": "[concat(parameters('sites_app_iotfoottraffic_sensor_retail_name'), '/ftp')]",
         "location": "[parameters('location')]",
         "dependsOn": [
            "[resourceId('Microsoft.Web/sites', parameters('sites_app_iotfoottraffic_sensor_retail_name'))]"
         ],
         "properties": {
            "allow": true
         }
      },
      {
         "type": "Microsoft.Web/sites/basicPublishingCredentialsPolicies",
         "apiVersion": "2021-02-01",
         "name": "[concat(parameters('sites_app_iotfoottraffic_sensor_retail_name'), '/scm')]",
         "location": "[parameters('location')]",
         "dependsOn": [
            "[resourceId('Microsoft.Web/sites', parameters('sites_app_iotfoottraffic_sensor_retail_name'))]"
         ],
         "properties": {
            "allow": true
         }
      },
      {
         "type": "Microsoft.Web/sites/config",
         "apiVersion": "2021-02-01",
         "name": "[concat(parameters('sites_app_iotfoottraffic_sensor_retail_name'), '/web')]",
         "location": "[parameters('location')]",
         "dependsOn": [
            "[resourceId('Microsoft.Web/sites', parameters('sites_app_iotfoottraffic_sensor_retail_name'))]"
         ],
         "properties": {
            "numberOfWorkers": 1,
            "defaultDocuments": [
               "Default.htm",
               "Default.html",
               "Default.asp",
               "index.htm",
               "index.html",
               "iisstart.htm",
               "default.aspx",
               "index.php",
               "hostingstart.html"
            ],
            "netFrameworkVersion": "v4.0",
            "linuxFxVersion": "PYTHON|3.7",
            "requestTracingEnabled": false,
            "remoteDebuggingEnabled": false,
            "remoteDebuggingVersion": "VS2017",
            "httpLoggingEnabled": true,
            "acrUseManagedIdentityCreds": false,
            "logsDirectorySizeLimit": 35,
            "detailedErrorLoggingEnabled": false,
            "publishingUsername": "[concat('$',parameters('sites_app_iotfoottraffic_sensor_retail_name'))]",
            "scmType": "None",
            "use32BitWorkerProcess": true,
            "webSocketsEnabled": false,
            "alwaysOn": true,
            "appCommandLine": "",
            "managedPipelineMode": "Integrated",
            "virtualApplications": [
               {
                  "virtualPath": "/",
                  "physicalPath": "site\\wwwroot",
                  "preloadEnabled": false
               }
            ],
            "loadBalancing": "LeastRequests",
            "experiments": {
               "rampUpRules": [

               ]
            },
            "autoHealEnabled": false,
            "vnetRouteAllEnabled": false,
            "vnetPrivatePortsCount": 0,
            "cors": {
               "allowedOrigins": [
                  "https://botservice.hosting.portal.azure.net",
                  "https://hosting.onecloud.azure-test.net/"
               ],
               "supportCredentials": false
            },
            "localMySqlEnabled": false,
            "ipSecurityRestrictions": [
               {
                  "ipAddress": "Any",
                  "action": "Allow",
                  "priority": 1,
                  "name": "Allow all",
                  "description": "Allow all access"
               }
            ],
            "scmIpSecurityRestrictions": [
               {
                  "ipAddress": "Any",
                  "action": "Allow",
                  "priority": 1,
                  "name": "Allow all",
                  "description": "Allow all access"
               }
            ],
            "scmIpSecurityRestrictionsUseMain": false,
            "http20Enabled": false,
            "minTlsVersion": "1.2",
            "scmMinTlsVersion": "1.0",
            "ftpsState": "AllAllowed",
            "preWarmedInstanceCount": 0,
            "functionAppScaleLimit": 0,
            "functionsRuntimeScaleMonitoringEnabled": false,
            "minimumElasticInstanceCount": 0,
            "azureStorageAccounts": {

            }
         }
      },
      {
         "type": "Microsoft.Web/sites/hostNameBindings",
         "apiVersion": "2021-02-01",
         "name": "[concat(parameters('sites_app_iotfoottraffic_sensor_retail_name'), '/', parameters('sites_app_iotfoottraffic_sensor_retail_name'), '.azurewebsites.net')]",
         "location": "[parameters('location')]",
         "dependsOn": [
            "[resourceId('Microsoft.Web/sites', parameters('sites_app_iotfoottraffic_sensor_retail_name'))]"
         ],
         "properties": {
            "siteName": "[parameters('sites_app_iotfoottraffic_sensor_retail_name')]",
            "hostNameType": "Verified"
         }
      },
      {
         "type": "Microsoft.Web/serverfarms",
         "apiVersion": "2021-03-01",
         "name": "[parameters('func_livestreaming_video_analytics_asp_name')]",
         "location": "[parameters('location')]",
         "sku": {
            "name": "S1",
            "tier": "Standard",
            "size": "S1",
            "family": "S",
            "capacity": 1
         },
         "kind": "app",
         "properties": {
            "perSiteScaling": false,
            "elasticScaleEnabled": false,
            "maximumElasticWorkerCount": 1,
            "isSpot": false,
            "reserved": false,
            "isXenon": false,
            "hyperV": false,
            "targetWorkerCount": 0,
            "targetWorkerSizeId": 0,
            "zoneRedundant": false
         }
      },
      {
         "type": "Microsoft.Web/sites",
         "apiVersion": "2021-03-01",
         "name": "[parameters('func_livestreaming_video_analytics_name')]",
         "location": "[parameters('location')]",
         "kind": "functionapp",
         "dependsOn": [
            "[resourceId('Microsoft.Web/serverfarms', parameters('func_livestreaming_video_analytics_asp_name'))]"
         ],
         "properties": {
            "enabled": true,
            "hostNameSslStates": [
               {
                  "name": "[concat(parameters('func_livestreaming_video_analytics_name'), '.azurewebsites.net')]",
                  "sslState": "Disabled",
                  "hostType": "Standard"
               },
               {
                  "name": "[concat(parameters('func_livestreaming_video_analytics_name'), '.scm.azurewebsites.net')]",
                  "sslState": "Disabled",
                  "hostType": "Repository"
               }
            ],
            "serverFarmId": "[resourceId(parameters('resource_group_name'), 'Microsoft.Web/serverfarms', parameters('func_livestreaming_video_analytics_asp_name'))]",
            "reserved": false,
            "isXenon": false,
            "hyperV": false,
            "siteConfig": {
               "numberOfWorkers": 1,
               "acrUseManagedIdentityCreds": false,
               "alwaysOn": true,
               "http20Enabled": false,
               "functionAppScaleLimit": 0,
               "minimumElasticInstanceCount": 0,
               "appSettings": [
                  {
                     "name": "PowerbiStreamingUrl",
                     "value": "[parameters('livestreaming_video_analytics_Realtime_URL')]"
                  },
                  {
                     "name": "FUNCTIONS_EXTENSION_VERSION",
                     "value": "~2"
                  },
                  {
                     "name": "FUNCTIONS_WORKER_RUNTIME",
                     "value": "dotnet"
                  }
               ]
            },
            "scmSiteAlsoStopped": false,
            "clientAffinityEnabled": false,
            "clientCertEnabled": false,
            "clientCertMode": "Required",
            "hostNamesDisabled": false,
            "customDomainVerificationId": "B10DC0753E56AF5562749748B185627EB8773B3C5160FA954F891FDBF5E7D19A",
            "containerSize": 1536,
            "dailyMemoryTimeQuota": 0,
            "httpsOnly": false,
            "redundancyMode": "None",
            "storageAccountRequired": false,
            "keyVaultReferenceIdentity": "SystemAssigned"
         }
      },
      {
         "type": "Microsoft.Web/sites/basicPublishingCredentialsPolicies",
         "apiVersion": "2021-03-01",
         "name": "[concat(parameters('func_livestreaming_video_analytics_name'), '/ftp')]",
         "location": "[parameters('location')]",
         "dependsOn": [
            "[resourceId('Microsoft.Web/sites', parameters('func_livestreaming_video_analytics_name'))]"
         ],
         "properties": {
            "allow": true
         }
      },
      {
         "type": "Microsoft.Web/sites/basicPublishingCredentialsPolicies",
         "apiVersion": "2021-03-01",
         "name": "[concat(parameters('func_livestreaming_video_analytics_name'), '/scm')]",
         "location": "[parameters('location')]",
         "dependsOn": [
            "[resourceId('Microsoft.Web/sites', parameters('func_livestreaming_video_analytics_name'))]"
         ],
         "properties": {
            "allow": true
         }
      },
      {
         "type": "Microsoft.Web/sites/config",
         "apiVersion": "2021-03-01",
         "name": "[concat(parameters('func_livestreaming_video_analytics_name'), '/web')]",
         "location": "[parameters('location')]",
         "dependsOn": [
            "[resourceId('Microsoft.Web/sites', parameters('func_livestreaming_video_analytics_name'))]"
         ],
         "properties": {
            "numberOfWorkers": 1,
            "defaultDocuments": [
               "Default.htm",
               "Default.html",
               "Default.asp",
               "index.htm",
               "index.html",
               "iisstart.htm",
               "default.aspx",
               "index.php"
            ],
            "netFrameworkVersion": "v6.0",
            "requestTracingEnabled": false,
            "remoteDebuggingEnabled": false,
            "remoteDebuggingVersion": "VS2019",
            "httpLoggingEnabled": false,
            "acrUseManagedIdentityCreds": false,
            "logsDirectorySizeLimit": 35,
            "detailedErrorLoggingEnabled": false,
            "publishingUsername": "[concat('$',parameters('func_livestreaming_video_analytics_name'))]",
            "scmType": "None",
            "use32BitWorkerProcess": true,
            "webSocketsEnabled": false,
            "alwaysOn": true,
            "managedPipelineMode": "Integrated",
            "virtualApplications": [
               {
                  "virtualPath": "/",
                  "physicalPath": "site\\wwwroot",
                  "preloadEnabled": true
               }
            ],
            "loadBalancing": "LeastRequests",
            "experiments": {
               "rampUpRules": []
            },
            "autoHealEnabled": false,
            "vnetRouteAllEnabled": false,
            "vnetPrivatePortsCount": 0,
            "cors": {
               "allowedOrigins": [
                  "https://portal.azure.com"
               ],
               "supportCredentials": false
            },
            "localMySqlEnabled": false,
            "ipSecurityRestrictions": [
               {
                  "ipAddress": "Any",
                  "action": "Allow",
                  "priority": 1,
                  "name": "Allow all",
                  "description": "Allow all access"
               }
            ],
            "scmIpSecurityRestrictions": [
               {
                  "ipAddress": "Any",
                  "action": "Allow",
                  "priority": 1,
                  "name": "Allow all",
                  "description": "Allow all access"
               }
            ],
            "scmIpSecurityRestrictionsUseMain": false,
            "http20Enabled": false,
            "minTlsVersion": "1.2",
            "scmMinTlsVersion": "1.0",
            "ftpsState": "AllAllowed",
            "preWarmedInstanceCount": 0,
            "functionAppScaleLimit": 0,
            "functionsRuntimeScaleMonitoringEnabled": false,
            "minimumElasticInstanceCount": 0,
            "azureStorageAccounts": {}
         }
      },
      {
         "type": "Microsoft.Web/sites/hostNameBindings",
         "apiVersion": "2021-03-01",
         "name": "[concat(parameters('func_livestreaming_video_analytics_name'), '/', parameters('func_livestreaming_video_analytics_name'), '.azurewebsites.net')]",
         "location": "[parameters('location')]",
         "dependsOn": [
            "[resourceId('Microsoft.Web/sites', parameters('func_livestreaming_video_analytics_name'))]"
         ],
         "properties": {
            "siteName": "[parameters('func_livestreaming_video_analytics_name')]",
            "hostNameType": "Verified"
         }
      },
      {
         "type": "Microsoft.Web/serverfarms",
         "apiVersion": "2021-03-01",
         "name": "[parameters('func_product_search_asp_name')]",
         "location": "[parameters('location')]",
         "sku": {
            "name": "S1",
            "tier": "Standard",
            "size": "S1",
            "family": "S",
            "capacity": 1
         },
         "kind": "app",
         "properties": {
            "perSiteScaling": false,
            "elasticScaleEnabled": false,
            "maximumElasticWorkerCount": 1,
            "isSpot": false,
            "reserved": false,
            "isXenon": false,
            "hyperV": false,
            "targetWorkerCount": 0,
            "targetWorkerSizeId": 0,
            "zoneRedundant": false
         }
      },
      {
         "name": "[parameters('serverfarm_product_search_ui_app_name')]",
         "type": "Microsoft.Web/serverfarms",
         "apiVersion": "2019-08-01",
         "kind": "app",
         "location": "[parameters('location')]",
         "properties": {
            "name": "[parameters('serverfarm_product_search_ui_app_name')]"
         },
         "sku": {
            "name": "S1"
         }
      },
      {
         "name": "[parameters('sites_product_search_ui_app_name')]",
         "type": "Microsoft.Web/sites",
         "apiVersion": "2021-03-01",
         "kind": "app",
         "location": "[parameters('location')]",
         "dependsOn": [
            "[concat('Microsoft.Web/serverfarms/', toLower(parameters('serverfarm_product_search_ui_app_name')))]"
         ],
         "properties": {
            "enabled": true,
            "hostNameSslStates": [
               {
                  "name": "[concat(parameters('sites_product_search_ui_app_name'), '.azurewebsites.net')]",
                  "sslState": "Disabled",
                  "hostType": "Standard"
               },
               {
                  "name": "[concat(parameters('sites_product_search_ui_app_name'), '.scm.azurewebsites.net')]",
                  "sslState": "Disabled",
                  "hostType": "Repository"
               }
            ],
            "serverFarmId": "[resourceId(parameters('resource_group_name'),'Microsoft.Web/serverfarms', parameters('serverfarm_product_search_ui_app_name'))]",
            "reserved": false,
            "isXenon": false,
            "hyperV": false,
            "siteConfig": {
               "numberOfWorkers": 1,
               "acrUseManagedIdentityCreds": false,
               "alwaysOn": true,
               "http20Enabled": false,
               "functionAppScaleLimit": 0,
               "minimumElasticInstanceCount": 0
            },
            "scmSiteAlsoStopped": false,
            "clientAffinityEnabled": true,
            "clientCertEnabled": false,
            "clientCertMode": "Required",
            "hostNamesDisabled": false,
            "customDomainVerificationId": "A4AE5B4D8DF5A1171AD5FE6A3AC1C147AA8BE402EDA35DC9661253EEB2078009",
            "containerSize": 0,
            "dailyMemoryTimeQuota": 0,
            "httpsOnly": true,
            "redundancyMode": "None",
            "storageAccountRequired": false,
            "keyVaultReferenceIdentity": "SystemAssigned"
         }
      },
      {
         "type": "Microsoft.Web/sites/config",
         "apiVersion": "2021-03-01",
         "name": "[concat(parameters('sites_product_search_ui_app_name'), '/web')]",
         "location": "East US",
         "dependsOn": [
            "[resourceId('Microsoft.Web/sites', parameters('sites_product_search_ui_app_name'))]"
         ],
         "properties": {
            "numberOfWorkers": 1,
            "defaultDocuments": [
               "Default.htm",
               "Default.html",
               "Default.asp",
               "index.htm",
               "index.html",
               "iisstart.htm",
               "default.aspx",
               "index.php",
               "hostingstart.html"
            ],
            "netFrameworkVersion": "v4.0",
            "phpVersion": "5.6",
            "requestTracingEnabled": false,
            "remoteDebuggingEnabled": false,
            "httpLoggingEnabled": false,
            "acrUseManagedIdentityCreds": false,
            "logsDirectorySizeLimit": 35,
            "detailedErrorLoggingEnabled": false,
            "publishingUsername": "[concat('$',parameters('sites_product_search_ui_app_name'))]",
            "scmType": "None",
            "use32BitWorkerProcess": true,
            "webSocketsEnabled": false,
            "alwaysOn": true,
            "managedPipelineMode": "Integrated",
            "virtualApplications": [
               {
                  "virtualPath": "/",
                  "physicalPath": "site\\wwwroot",
                  "preloadEnabled": true
               }
            ],
            "loadBalancing": "LeastRequests",
            "experiments": {
               "rampUpRules": []
            },
            "autoHealEnabled": false,
            "vnetRouteAllEnabled": false,
            "vnetPrivatePortsCount": 0,
            "cors": {
               "allowedOrigins": [
                  "*"
               ],
               "supportCredentials": false
            },
            "localMySqlEnabled": false,
            "ipSecurityRestrictions": [
               {
                  "ipAddress": "Any",
                  "action": "Allow",
                  "priority": 1,
                  "name": "Allow all",
                  "description": "Allow all access"
               }
            ],
            "scmIpSecurityRestrictions": [
               {
                  "ipAddress": "Any",
                  "action": "Allow",
                  "priority": 1,
                  "name": "Allow all",
                  "description": "Allow all access"
               }
            ],
            "scmIpSecurityRestrictionsUseMain": false,
            "http20Enabled": false,
            "minTlsVersion": "1.2",
            "scmMinTlsVersion": "1.0",
            "ftpsState": "AllAllowed",
            "preWarmedInstanceCount": 0
         }
      }
   ],
   "outputs": {}
}