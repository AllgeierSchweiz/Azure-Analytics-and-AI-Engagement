{
   "$schema":"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
   "contentVersion":"1.0.0.0",
   "parameters":{
      "cosmosdb_retail2_name":{
         "type":"String",
         "metadata":{
            "description":""
         }
      },
      "cosmos_database_name":{
         "type":"String",
         "metadata":{
            "description":""
         }
      },
      "cosmos_database_video_indexer":{
        "type":"String",
        "metadata":{
           "description":""
        }
     },
     "cosmos_database_name_retailinventorydb":{
        "type":"String",
        "metadata":{
           "description":""
        }
     },
     "cosmos_database_container_name_videoindexerinsights":{
        "type":"String",
        "metadata":{
           "description":""
        }
     },
     "cosmos_database_container_name_Transcript":{
        "type":"String",
        "metadata":{
           "description":""
        }
     },
     "connections_cosmosdb_name":{
        "type":"String",
        "metadata":{
           "description":""
        }
     },
      "location":{
         "type":"String",
         "metadata":{
            "description":"PowerBi workspace Id."
         }
      }
   },
   "variables":{},
   "resources":[
      {
         "name": "[parameters('connections_cosmosdb_name')]",
         "type": "Microsoft.Web/connections",
         "apiVersion": "2016-06-01",
         "location": "[parameters('location')]",
         "kind": "V1",
         "dependsOn": [
         "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('cosmosdb_retail2_name'))]"
         ],
         "properties": {
         "displayName": "documentdb",
         "parameterValues": {
            "databaseAccount": "[parameters('cosmosdb_retail2_name')]",
            "accessKey": "[listKeys(resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('cosmosdb_retail2_name')), providers('Microsoft.DocumentDB', 'databaseAccounts').apiVersions[0]).primaryMasterKey]"
         },
         "api": {
            "id": "[concat(subscription().id,'/providers/Microsoft.Web/locations/', parameters('location'), '/managedApis/documentdb')]"
         }
         }
      },
      {
         "name": "[concat(parameters('cosmosdb_retail2_name'), '/', toLower(parameters('cosmos_database_video_indexer')))]",
         "type": "Microsoft.DocumentDB/databaseAccounts/sqlDatabases",
         "apiVersion": "2019-12-12",
         "dependsOn": [
         "[concat('Microsoft.DocumentDB/databaseAccounts/', toLower(parameters('cosmosdb_retail2_name')))]"
         ],
         "properties": {
         "resource": {
            "id": "[parameters('cosmos_database_video_indexer')]"
         }
         }
      },
     {
         "name": "[concat(parameters('cosmosdb_retail2_name'), '/', parameters('cosmos_database_video_indexer'), '/', parameters('cosmos_database_container_name_videoindexerinsights'))]",
         "type": "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers",
         "apiVersion": "2020-04-01",
         "location": "[parameters('location')]",
         "dependsOn": [
         "[resourceId('Microsoft.DocumentDB/databaseAccounts/sqlDatabases',parameters('cosmosdb_retail2_name'),parameters('cosmos_database_video_indexer'))]"
         ],
         "properties": {
         "resource": {
            "id": "[parameters('cosmos_database_container_name_videoindexerinsights')]",
            "indexingPolicy": {
               "automatic": true,
               "indexingMode": "consistent",
               "includedPaths": [
               {
                  "path": "/*"
               }
               ],
               "excludedPaths": [
               {
                  "path": "/\"_etag\"/?"
               }
               ]
            },
            "partitionKey": {
               "paths": [
               "/id"
               ],
               "kind": "Hash"
            },
            "analyticalStorageTtl": -1,
            "conflictResolutionPolicy": {
               "mode": "LastWriterWins",
               "conflictResolutionPath": "/_ts"
            }
         },
         "options": {
            "autoscaleSettings": {
               "maxThroughput": "4000"
            }
         }
         }
      },
      {
        "name": "[concat(parameters('cosmosdb_retail2_name'), '/', parameters('cosmos_database_video_indexer'), '/', parameters('cosmos_database_container_name_Transcript'))]",
        "type": "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers",
        "apiVersion": "2020-04-01",
        "location": "[parameters('location')]",
        "dependsOn": [
        "[resourceId('Microsoft.DocumentDB/databaseAccounts/sqlDatabases',parameters('cosmosdb_retail2_name'),parameters('cosmos_database_video_indexer'))]"
        ],
        "properties": {
        "resource": {
           "id": "[parameters('cosmos_database_container_name_Transcript')]",
           "indexingPolicy": {
              "automatic": true,
              "indexingMode": "consistent",
              "includedPaths": [
              {
                 "path": "/*"
              }
              ],
              "excludedPaths": [
              {
                 "path": "/\"_etag\"/?"
              }
              ]
           },
           "partitionKey": {
              "paths": [
              "/videoid"
              ],
              "kind": "Hash"
           },
           "analyticalStorageTtl": -1,
           "conflictResolutionPolicy": {
              "mode": "LastWriterWins",
              "conflictResolutionPath": "/_ts"
           }
        },
        "options": {
           "autoscaleSettings": {
              "maxThroughput": "4000"
           }
        }
        }
     },
      {
         "type":"Microsoft.DocumentDB/databaseAccounts",
         "apiVersion":"2021-10-15",
         "name":"[parameters('cosmosdb_retail2_name')]",
         "location":"[parameters('location')]",
         "kind":"GlobalDocumentDB",
         "identity":{
            "type":"None"
         },
         "properties":{
            "publicNetworkAccess":"Enabled",
            "enableAutomaticFailover":false,
            "enableMultipleWriteLocations":false,
            "isVirtualNetworkFilterEnabled":false,
            "virtualNetworkRules":[
               
            ],
            "disableKeyBasedMetadataWriteAccess":false,
            "enableFreeTier":false,
            "enableAnalyticalStorage":true,
            "analyticalStorageConfiguration":{
               "schemaType":"WellDefined"
            },
            "databaseAccountOfferType":"Standard",
            "defaultIdentity":"FirstPartyIdentity",
            "networkAclBypass":"None",
            "disableLocalAuth":false,
            "consistencyPolicy":{
               "defaultConsistencyLevel":"Session",
               "maxIntervalInSeconds":5,
               "maxStalenessPrefix":100
            },
            "locations":[
               {
                  "locationName":"[parameters('location')]",
                  "provisioningState":"Succeeded",
                  "failoverPriority":0,
                  "isZoneRedundant":false
               }
            ],
            "cors":[
               
            ],
            "capabilities":[
               
            ],
            "ipRules":[
               
            ],
            "backupPolicy":{
               "type":"Periodic",
               "periodicModeProperties":{
                  "backupIntervalInMinutes":240,
                  "backupRetentionIntervalInHours":8,
                  "backupStorageRedundancy":"Geo"
               }
            },
            "networkAclBypassResourceIds":[
               
            ]
         }
      },
      {
        "type":"Microsoft.DocumentDB/databaseAccounts/sqlDatabases",
        "apiVersion":"2021-10-15",
        "name":"[concat(parameters('cosmosdb_retail2_name'),'/' ,parameters('cosmos_database_name'))]",
        "dependsOn":[
           "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('cosmosdb_retail2_name'))]"
        ],
        "properties":{
           "resource":{
              "id":"[parameters('cosmos_database_name')]"
           }
        }
     },
     {
        "type":"Microsoft.DocumentDB/databaseAccounts/sqlRoleDefinitions",
        "apiVersion":"2021-10-15",
        "name":"[concat(parameters('cosmosdb_retail2_name'), '/00000000-0000-0000-0000-000000000001')]",
        "dependsOn":[
           "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('cosmosdb_retail2_name'))]"
        ],
        "properties":{
           "roleName":"Cosmos DB Built-in Data Reader",
           "type":"BuiltInRole",
           "assignableScopes":[
              "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('cosmosdb_retail2_name'))]"
           ],
           "permissions":[
              {
                 "dataActions":[
                    "Microsoft.DocumentDB/databaseAccounts/readMetadata",
                    "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/executeQuery",
                    "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/readChangeFeed",
                    "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/items/read"
                 ],
                 "notDataActions":[
                    
                 ]
              }
           ]
        }
     },
     {
        "type":"Microsoft.DocumentDB/databaseAccounts/sqlRoleDefinitions",
        "apiVersion":"2021-10-15",
        "name":"[concat(parameters('cosmosdb_retail2_name'), '/00000000-0000-0000-0000-000000000002')]",
        "dependsOn":[
           "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('cosmosdb_retail2_name'))]"
        ],
        "properties":{
           "roleName":"Cosmos DB Built-in Data Contributor",
           "type":"BuiltInRole",
           "assignableScopes":[
              "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('cosmosdb_retail2_name'))]"
           ],
           "permissions":[
              {
                 "dataActions":[
                    "Microsoft.DocumentDB/databaseAccounts/readMetadata",
                    "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/*",
                    "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/items/*"
                 ],
                 "notDataActions":[
                    
                 ]
              }
           ]
        }
     },
     {
        "type":"Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers",
        "apiVersion":"2021-10-15",
        "name":"[concat(parameters('cosmosdb_retail2_name'),'/',parameters('cosmos_database_name'),'/retailcosmos')]",
        "dependsOn":[
           "[resourceId('Microsoft.DocumentDB/databaseAccounts/sqlDatabases', parameters('cosmosdb_retail2_name'),parameters('cosmos_database_name'))]",
           "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('cosmosdb_retail2_name'))]"
        ],
        "properties":{
           "resource":{
              "id":"retailcosmos",
              "indexingPolicy":{
                 "indexingMode":"consistent",
                 "automatic":true,
                 "includedPaths":[
                    {
                       "path":"/*"
                    }
                 ],
                 "excludedPaths":[
                    {
                       "path":"/\"_etag\"/?"
                    }
                 ]
              },
              "partitionKey":{
                 "paths":[
                    "/TransactionType"
                 ],
                 "kind":"Hash"
              },
              "uniqueKeyPolicy":{
                 "uniqueKeys":[
                    
                 ]
              },
              "conflictResolutionPolicy":{
                 "mode":"LastWriterWins",
                 "conflictResolutionPath":"/_ts"
              },
              "analyticalStorageTtl":-1
           },
           "options":{
              "autoscaleSettings":{
                 "maxThroughput":"4000"
              }
           }
        }
     },
     {
        "type":"Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers",
        "apiVersion":"2021-10-15",
        "name":"[concat(parameters('cosmosdb_retail2_name'),'/',parameters('cosmos_database_name'),'/retaildb')]",
        "dependsOn":[
           "[resourceId('Microsoft.DocumentDB/databaseAccounts/sqlDatabases', parameters('cosmosdb_retail2_name'),parameters('cosmos_database_name'))]",
           "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('cosmosdb_retail2_name'))]"
        ],
        "properties":{
           "resource":{
              "id":"retaildb",
              "indexingPolicy":{
                 "indexingMode":"consistent",
                 "automatic":true,
                 "includedPaths":[
                    {
                       "path":"/*"
                    }
                 ],
                 "excludedPaths":[
                    {
                       "path":"/\"_etag\"/?"
                    }
                 ]
              },
              "partitionKey":{
                 "paths":[
                    "/beforefoottraffic"
                 ],
                 "kind":"Hash"
              },
              "uniqueKeyPolicy":{
                 "uniqueKeys":[
                    
                 ]
              },
              "conflictResolutionPolicy":{
                 "mode":"LastWriterWins",
                 "conflictResolutionPath":"/_ts"
              },
              "analyticalStorageTtl":-1
           },
           "options":{
              "autoscaleSettings":{
                 "maxThroughput":"4000"
              }
           }
        }
     },
      {
        "type":"Microsoft.DocumentDB/databaseAccounts/sqlDatabases",
        "apiVersion":"2021-10-15",
        "name":"[concat(parameters('cosmosdb_retail2_name'),'/' ,parameters('cosmos_database_name_retailinventorydb'))]",
        "dependsOn":[
           "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('cosmosdb_retail2_name'))]"
        ],
        "properties":{
           "resource":{
              "id":"[parameters('cosmos_database_name_retailinventorydb')]"
           }
        }
     },
        {
        "type":"Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers",
        "apiVersion":"2021-10-15",
        "name":"[concat(parameters('cosmosdb_retail2_name'),'/',parameters('cosmos_database_name_retailinventorydb'),'/inventorydb')]",
        "dependsOn":[
           "[resourceId('Microsoft.DocumentDB/databaseAccounts/sqlDatabases', parameters('cosmosdb_retail2_name'),parameters('cosmos_database_name_retailinventorydb'))]",
           "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('cosmosdb_retail2_name'))]"
        ],
        "properties":{
           "resource":{
              "id":"inventorydb",
              "indexingPolicy":{
                 "indexingMode":"consistent",
                 "automatic":true,
                 "includedPaths":[
                    {
                       "path":"/*"
                    }
                 ],
                 "excludedPaths":[
                    {
                       "path":"/\"_etag\"/?"
                    }
                 ]
              },
              "partitionKey":{
                 "paths":[
                    "/InventoryType"
                 ],
                 "kind":"Hash"
              },
              "uniqueKeyPolicy":{
                 "uniqueKeys":[
                    
                 ]
              },
              "conflictResolutionPolicy":{
                 "mode":"LastWriterWins",
                 "conflictResolutionPath":"/_ts"
              },
              "analyticalStorageTtl":-1
           },
           "options":{
              "autoscaleSettings":{
                 "maxThroughput":"4000"
              }
           }
        }
     }
   ],
   "outputs":{
      
   }
}