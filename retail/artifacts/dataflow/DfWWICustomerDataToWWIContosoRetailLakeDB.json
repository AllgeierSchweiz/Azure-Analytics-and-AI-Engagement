{
    "name": "DfWWICustomerDataToWWIContosoRetailLakeDB",
    "properties": {
        "folder": {
            "name": "Load WWI And Magento Data To LakeDB"
        },
        "type": "MappingDataFlow",
        "typeProperties": {
            "sources": [
                {
                    "dataset": {
                        "referenceName": "WWICustomer",
                        "type": "DatasetReference"
                    },
                    "name": "WWICustomerData"
                }
            ],
            "sinks": [
                {
                    "name": "Customer"
                }
            ],
            "transformations": [
                {
                    "name": "GetEntityCodeForCustomer"
                },
                {
                    "name": "GetCustomerAttributes"
                },
                {
                    "name": "FilterDOB"
                }
            ],
            "script": "source(output(\n\t\tId as string,\n\t\tAge as string,\n\t\tGender as string,\n\t\tPincode as string,\n\t\tFirstName as string,\n\t\tLastName as string,\n\t\tFullName as string,\n\t\tDateOfBirth as date,\n\t\tAddress as string,\n\t\tEmail as string,\n\t\tMobile as string,\n\t\tUserName as string,\n\t\tOrderId as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> WWICustomerData\nFilterDOB derive(EntityCode = 'WideWorldImporters',\n\t\tCustomerMiddleName = 'Null',\n\t\tCustomerGenderNote = concat(Gender,' ' ,'Customer'),\n\t\tCustomerEmailID = 'Null',\n\t\tCity = split(substring(Address, 0, length(Address)), \",\")[2],\n\t\tCountry = split(substring(Address, 0, length(Address)), \",\")[3],\n\t\tcolumn1DOB = case(year(DateOfBirth)>=1981 && year(DateOfBirth)<=1996,subMonths(DateOfBirth,420),DateOfBirth)) ~> GetEntityCodeForCustomer\nGetEntityCodeForCustomer select(mapColumn(\n\t\tCustomerId = Id,\n\t\tCustomerFirstName = FirstName,\n\t\tCustomerLastName = LastName,\n\t\tCustomerFullName = FullName,\n\t\tCustomerDOB = column1DOB,\n\t\tEntityCode,\n\t\tOrderId,\n\t\tCustomerMiddleName,\n\t\tCustomerEmailAddress = Email,\n\t\tCustomerGender = Gender,\n\t\tCity,\n\t\tCountry\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> GetCustomerAttributes\nWWICustomerData filter(!isNull(DateOfBirth)) ~> FilterDOB\nGetCustomerAttributes sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tstore: 'synapse',\n\tdatabaseType: 'spark',\n\tformat: 'table',\n\tdatabase: 'WWImportersContosoRetailLakeDB',\n\ttableName: 'WWImporterContosoCustomers',\n\tmapColumn(\n\t\tCustomerId,\n\t\tCustomerFirstName,\n\t\tCustomerMiddleName,\n\t\tCustomerLastName,\n\t\tCustomerFullName,\n\t\tCustomerDOB,\n\t\tEntityCode,\n\t\tOrderId,\n\t\tCustomerEmailAddress,\n\t\tCustomerGender,\n\t\tCity,\n\t\tCountry\n\t)) ~> Customer"
        }
    }
}